<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/css/all.css">
    <script src="/js/admin/jquery.min.js"></script>
    <link rel="icon" href="/img/admin/black_icon.png" type="image/gif" sizes="16x16">
    <title>function.pop</title>
    <style>
        .fpop_inp {
            height: 35px;
            width: 100%;
            border: 1px solid #acacac;
            border-radius: 6px;
            font-size: 10px;
            margin: 10px 0;
            padding: 0 10px;
        }

        .fpop_inp:focus {
            background-color: #ececec;
        }

        .footerMell>div>div>a {
            color: white;
            font-size: small;

        }

        .fpop_inperro {
            height: 35px;
            width: 100%;
            border: 1px solid #d83838;
            border-radius: 6px;
            font-size: 10px;
            margin: 10px 0;
            padding: 0 10px;
        }

        .inp_right {
            border: 1px solid #33a51d;
            border-radius: 6px;
            background-color: azure;
        }

        .inp_Err {
            text-align: right;
            font-size: 5px;
            color: #d83838;
        }
    </style>
</head>

<body>

    <nav>
        <%- include("navbar.ejs") %>
    </nav>
    <div style="margin: 0px auto 100px; width: 300px;">
        <h6 style="font-weight: 600;text-align: center;">註冊新帳號</h6>
        <p style="text-align: center;">儲存您的資料,享有快速結帳流程、建立願望清單、查看訂單紀錄、查詢退貨紀錄。</p>
        <p style="opacity: 0.6;text-align: center;">*星號欄位必填</p>
        <form id="form">

            <label>姓名*:</label>
            <p class="inp_Err" style="visibility: hidden" id="nameErr">請填寫姓名欄位*</p>
            <input class="fpop_inp" type="text" id="cName" name="cName" placeholder="名字*">


            <label>生日*:</label>
            <p class="inp_Err" style="visibility: hidden" id="birthErr">請填寫生日欄位*</p>
            <input class="fpop_inp" type="date" id="cBirth" name="cBirth">
            <label>性別*:</label>
            <p class="inp_Err" style="visibility: hidden" id="genderErr">請填寫性別欄位*</p>
            <select class="fpop_inp" id="gender" name="cgender">
                <option name="gender" value="F">女性</option>
                <option name="gender" value="M">男性</option>
                <option name="gender" value="X">不說</option>
            </select>
            <label>電子郵件*:</label>
            <p class="inp_Err" style="visibility:hidden" id="accountErr">請填寫電子郵件欄位*</p>
            <p class="inp_Err" style="visibility:hidden" id="accountErr2">請輸入有效的郵箱地址*</p>
            <input class="fpop_inp" type="email" id="cAccount" name="cAccount" placeholder="電子郵件*">


            <label>連絡電話*：</label>
            <p class="inp_Err" style="visibility:hidden" id="phoneErr">請填寫連絡電話欄位*</p>
            <p class="inp_Err" style="visibility:hidden" id="phoneErr2">請填寫有效電話*</p>
            <input class="fpop_inp" type="tel" id="cPhone" name="cPhone" placeholder="連絡電話*">


            <label>通訊地址*：</label>
            <p class="inp_Err" style="visibility:hidden" id="addrErr">請填寫連絡通訊欄位*</p>
            <input class="fpop_inp" type="text" id="cAddr" name="cAddr" placeholder="通訊地址*"><br>

            <button class="btn btn-dark" id="submit">註冊會員</button>


        </form>
    </div>

    <script>
 
        $("#cName").on('input', function () {
            if (!($("#cName").val() == '')) {
                $("#cName").addClass("inp_right")
                $("#nameErr").css('visibility', 'hidden')
            }
        })
        $("#cBirth").on('input', function () {
            if (!($("#cBirth").val() == '')) {
                $("#cBirth").addClass("inp_right")
                $("#birthErr").css('visibility', 'hidden')
            }
        })
        $("#cAddr").on('input', function () {
            if (!($("#cAddr").val() == '')) {
                $("#cAddr").addClass("inp_right")
                $("#addrErr").css('visibility', 'hidden')
            }
        })
        $("#cAccount").on('input', function () {
            if (!$("#cAccount").val() == '') {
                $("#cAccount").addClass("inp_right")
                $("#accountErr").css('visibility', 'hidden')
            }
        })
        $("#cPhone").on('input', function () {
            if (!$("#cPhone").val() == '') {
                $("#cPhone").addClass("inp_right")
                $("#phoneErr").css('visibility', 'hidden')
            }
        })

        function checkInputInfo() {
            var x = $("#cName").val();
            var y = $("#cBirth").val();
            var p = $("#cPhone").val();
            var a = $("#cAddr").val();
            var e = $("#cAccount").val();
            var phoneFormat = /^09[0-9]{8}$/;
            var emailFormat = /^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
            var b = true;
            console.log("check ing");
            if (x == null || x == "") {
                $("#cName").addClass("fpop_inperro")
                $("#nameErr").css('visibility', 'visible')
                b = false
                console.log("check cName error");
            }
            if (y == null || y == "") {
                $("#cBirth").addClass("fpop_inperro")
                $("#birthErr").css('visibility', 'visible')
                b = false
                console.log("check cBirth error");
            }
            if (a == null || a == "") {
                $("#cAddr").addClass("fpop_inperro")
                $("#addrErr").css('visibility', 'visible')
                b = false
                console.log("check cAddr error");
            }

            if (e == null || e == "") {
                $("#cAccount").addClass("fpop_inperro")
                $("#accountErr").css('visibility', 'visible')
                b = false
                console.log("check cAccount error");
            } else if (!emailFormat.test(e)) {
                $("#cAccount").addClass("fpop_inperro")
                $("#cAccount").removeClass("inp_right")
                $("#accountErr").css('visibility', 'hidden')
                $("#accountErr2").css('visibility', 'visible')
                b = false
                console.log("check cAccount emailFormat error");
            }
            if (p == null || p == "") {
                $("#cPhone").addClass("fpop_inperro")
                $("#phoneErr").css('visibility', 'visible')
                b = false
                console.log("check cPhone error");
            } else if (!phoneFormat.test(p)) {
                $("#cPhone").addClass("fpop_inperro")
                $("#cPhone").removeClass("inp_right")
                $("#phoneErr").css('visibility', 'hidden')
                $("#phoneErr2").css('visibility', 'visible')
                b = false
                console.log("check cPhone phoneFormat error");
            }

            console.log("check break");

            return b
        }

        // 關鍵字 serializeArray() ,stringify()

        var isClick = false

        $("#submit").on('click', function () {
            console.log("btn  isClick:"+isClick);
            if(isClick){
                return
            }
            isClick = true;

            if (!checkInputInfo()) {
                alert("資料輸入有誤");
                return false
            }
            console.log("start post...");
            var data = $('#form').serializeArray()
            JSONData = serializeToJSON(data)
            $.ajax({
                url: "http://localhost:3000/home/register",
                type: "POST",
                contentType: "application/json; charset=utf-8",
                data: JSONData,
                
                error: function (data) {
                    console.log("error  :"+data);
                    alert("此帳號已有人使用!");
                    isClick = false;
                },
                success: function (data) {  
                    console.log("success  :"+data);   
                    alert("註冊成功!");
                    isClick = false;
                }
            });

            function serializeToJSON(data) {
                var values = {};
                for (index in data) {
                    values[data[index].name] = data[index].value;
                }
                return JSON.stringify(values)
            }
        
        })
    </script>

    <footer class="footer">
        <%- include("footer.ejs") %>
    </footer>
</body>

</html>